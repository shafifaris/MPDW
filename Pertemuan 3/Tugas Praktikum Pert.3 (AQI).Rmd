---
title: "Tugas Praktikum Pertemuan 3"
author: "Shafi Faris Arif Rabbani"
date: "2025-09-09"
output: rmdformats::readthedown
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Air Quality Index

## Library

```{r include=FALSE}
library(dLagM)
library(dynlm)
library(MLmetrics)
library(lmtest)
library(car)
library(ggplot2)
```

## Import Data

```{r}
NDA <- rio::import("https://raw.githubusercontent.com/shafifaris/MPDW/refs/heads/main/Pertemuan%203/NewDelhi_Air_quality.csv")
NDA
```

```{r}
str(NDA)
summary(NDA)
```

## Splitting Data

```{r}
# hitung jumlah data
n <- nrow(NDA)
# tentukan batas 80%
n_train <- floor(0.8 * n)
# bagi data
train <- NDA[1:n_train, ]
test  <- NDA[(n_train+1):n, ]
# ubah ke time series
train.ts<-ts(train)
test.ts<-ts(test)
NDA.ts<-ts(NDA)
```

## Eksplorasi Data

### Korelasi antar peubah dengan AQI

```{r}
#jadikan numeric 
train_numeric <- data.frame(lapply(train, as.numeric))
cor(train_numeric)
```

```{r}
#visualisasi korelasi
library(corrplot)
corrplot(cor(train_numeric), method = "circle", type = "upper", tl.col = "black", tl.srt = 45)
```

Dari hasil eksplorasi diatas, didapatkan konsentrasi ozon (O₃) di udara memiliki korelasi yang cukup tinggi yakni 0.93, oleh karena itu disini saya akan menggunakan peubah O3 sebagai peubah bebas (X) dan AQI sebagai peubah terikat (Y) dalam pemodelan regresi.

Selain itu, menurut Publikasi Jurnal Teknologi Lingkungan "Pengaruh Polusi Udara terhadap Deposisi Asam di Daerah Sekitar Pantai" tahun 2025, bahwa konsentrasi rata-rata O3 paling tinggi di antara parameter lainnya, sehingga menyebabkan deposisi asam sebagai akibat dari polusi udara dan memberikan dampak negatif yang luas dan telah menjadi permasalahan global dan menyebabkan gangguan kesehatan manusia.

### Model Regresi Linier Sederhana

```{r}
#regresi 
model.ls <- lm(AQI ~ o3, data = train)
summary(model.ls)
```

```{r}
# Plot data dan garis regresi
ggplot(train, aes(x = o3 , y = AQI)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Scatter plot AQI vs o3",
       x = "o3",
       y = "AQI")
# Korelasi antara AQI dan o3
ggplot(NDA, aes(x = o3, y = AQI)) +
  geom_point(color = "blue") +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Korelasi antara AQI dan o3", 
       x = "Konsentrasi o3", y = "AQI") +
  theme_minimal()
```

```{r}
cor(NDA$o3, NDA$AQI)
# Korelasi Pearson
cor.test(NDA$o3, NDA$AQI, method = "pearson")
# Korelasi Spearman
cor.test(NDA$o3, NDA$AQI, method = "spearman")
# Korelasi Kendall
cor.test(NDA$o3, NDA$AQI, method = "kendall")

```

## Model Koyck

### Pemodelan

```{r}
#MODEL KOYCK
model.koyck <- koyckDlm(x = train$o3, y = train$AQI)
summary(model.koyck)
AIC(model.koyck)
BIC(model.koyck)
```

**Interpretasi Hasil:**

-   Dari `summary`, kita dapatkan model:

    $$ \hat{Y_t}=0.54798+0.25823X_t+0.41955Y_{t-1} $$

    Koefisien $X_t$ (0.25823) signifikan, artinya nilai \$X\$ saat ini berpengaruh terhadap $Y$.

-   Koefisien $Y_{t−1}$ (0.41955) juga signifikan. Ini adalah **estimasi untuk** $\lambda$. Nilai ini menunjukkan bahwa sekitar 42% dari efek di periode sebelumnya masih "terbawa" ke periode saat ini.

### Peramalan dan Akurasi

Berikut adalah hasil peramalan y untuk 5 periode kedepan menggunakan model koyck

```{r}
fore.koyck <- forecast(model = model.koyck, x=test$o3, h=15)
fore.koyck
mape.koyck <- MAPE(fore.koyck$forecasts, test$AQI)
mape.koyck #data test
```

```{r}
#akurasi NDA training
GoF(model.koyck)
```

## Regression with Distributed Lag

```{r, eval=FALSE, error=FALSE}
dlm(formula , NDA , x , y , q , remove )
```

Fungsi `dlm()` akan menerapkan model lag terdistribusi dengan satu atau lebih prediktor. Nilai `x` dan `y` tidak perlu sebagai objek *time series* (`ts`). $q$ adalah integer yang mewakili panjang *lag* yang terbatas.

### Pemodelan (Lag=2)

```{r}
model.dlm <- dlm(x = train$o3,y = train$AQI , q = 2)
summary(model.dlm)
AIC(model.dlm)
BIC(model.dlm)
```

Dari hasil diatas, didapat bahwa $P-value$ dari intercept dan $x_{t-1}<0.05$. Hal ini menunjukkan bahwa intercept dan $x_{t-1}$ berpengaruh signifikan terhadap $y$. Adapun model keseluruhan yang terbentuk adalah sebagai berikut $$
\hat{Y_t}=-0.05278+0.47637X_t-0.00575X_{t-1}-0.00839X_{t-2}
$$ \### Akurasi dan Peramalan

### Peramalan dan Akurasi

Berikut merupakan hasil peramalan $y$ untuk 5 periode kedepan

```{r}
fore.dlm <- forecast(model = model.dlm, x=test$o3, h=15)
fore.dlm
mape.dlm <- MAPE(fore.dlm$forecasts, test$AQI)
mape.dlm
#akurasi NDA training
GoF(model.dlm)
```

### Lag Optimum

```{r}
finiteDLMauto(formula = AQI ~ o3,
              data = data.frame(train), q.min = 1, q.max = 10,
              model.type = "dlm", error.type = "AIC", trace = TRUE)
```

Berdasarkan output tersebut, didapatkan lag optimum adalah 10 dengan nilai AIC terkecil yaitu 22.97129 Hal ini sesuai dengan model yang telah dibuat sebelumnya. Dan perlu diketahui bahwa semakin besar nilai lag, maka nilai AIC akan semakin kecil. Sudah saya perpanjang lag nya dan menemukan lag optimum pada q=27 dan k=27. Tetapi itu membuat model nya hanya mendapat xt nya saja.

```{r}
#model dlm dengan lag optimum
model.dlm2 <- dlm(x = train$o3,y = train$AQI , q = 10)
summary(model.dlm2)
AIC(model.dlm2)
BIC(model.dlm2)
```

Dari hasil tersebut terdapat beberapa peubah yang berpengaruh signifikan terhadap taraf nyata 5% yaitu $x_t$ , $x_{t-7}$ , $x_{t-8}$ , $x_{t-9}$ , $x_{t-10}$. Adapun keseluruhan model yang terbentuk adalah

$$
\hat{Y_t}=-0.29478+0.405638X_t+...-0.098958 X_{t-10}
$$

Adapun hasil peramalan 5 periode kedepan menggunakan model tersebut adalah sebagai berikut

```{r}
#peramalan dan akurasi
fore.dlm2 <- forecast(model = model.dlm2, x=test$o3, h=15)

#akurasi NDA test
mape.dlm2<- MAPE(fore.dlm2$forecasts, test$AQI)
mape.dlm2

#akurasi NDA training
GoF(model.dlm2)
```

Model tersebut merupakan model yang sangat baik dengan nilai MAPE yang kurang dari 10%.

## Model Autoregressive

### Pemodelan

```{r}
model.ardl <- ardlDlm(x = train$o3, y = train$AQI, p = 1 , q = 1)
summary(model.ardl)
AIC(model.ardl)
BIC(model.ardl)
```

```{r}
model.ardl <- ardlDlm(formula = AQI ~ o3, 
                         data = train,p = 1 , q = 1)
summary(model.ardl)
AIC(model.ardl)
BIC(model.ardl)
```

Hasil di atas menunjukkan bahwa selain peubah $x_{t-1}$, hasil uji t menunjukkan nilai-p pada peubah $\ge0.05$ Hal ini menunjukkan bahwa peubah $x_{t-1}$ berpengaruh signifikan terhadap $y_t$, sementara $x_t$ dan $y_{t-1}$ berpengaruh signifikan terhadap $y_t$.\

### Peramalan dan Akurasi

```{r}
fore.ardl <- forecast(model = model.ardl, x=test$o3, h=15)
fore.ardl
```

```{r}
mape.ardl <- MAPE(fore.ardl$forecasts, test$AQI)
mape.ardl
#akurasi NDA training
GoF(model.ardl)
```

NDA di atas merupakan hasil peramalan untuk 15 periode ke depan menggunakan Model Autoregressive dengan $p=1$ dan $q=1$.

### *Lag* Optimum

```{r}
#penentuan lag optimum
model.ardl.opt <- ardlBoundOrders(data = data.frame(NDA), ic = "AIC", 
                                  formula = AQI ~ o3 )
model.ardl.opt
min_p=c()
for(i in 1:6){
  min_p[i]=min(model.ardl.opt$Stat.table[[i]])
}
q_opt=which(min_p==min(min_p, na.rm = TRUE))
p_opt=which(model.ardl.opt$Stat.table[[q_opt]] == 
              min(model.ardl.opt$Stat.table[[q_opt]], na.rm = TRUE))
data.frame("q_optimum" = q_opt, "p_optimum" = p_opt, 
           "AIC"=model.ardl.opt$min.Stat)
```

```{r}
model.ardl2 <- ardlDlm(formula = AQI ~ o3, 
                         data  = train,p = 13, q = 2)
summary(model.ardl2)
AIC(model.ardl2)
BIC(model.ardl2)
```

Dari tabel di atas, dapat terlihat bahwa nilai AIC terendah didapat ketika $p=6$ dan $q=2$, yaitu sebesar `29.4702`. Artinya, model autoregressive optimum didapat ketika $p=6$ dan $q=2$.

Selanjutnya dapat dilakukan pemodelan dengan nilai $p$ dan $q$ optimum seperti inisialisasi di langkah sebelumnya.

## Pemodelan DLM & ARDL dengan Library `dynlm`

```{r}
#sama dengan model dlm q=1
cons_lm1 <- dynlm(AQI ~ o3+L(o3, 1:10),data  = train.ts)
#sama dengan ardl p=13 q=2
cons_lm2 <- dynlm(AQI ~ L(AQI, 1:13) + L(o3, 0:2), data = train.ts)
```

### Ringkasan Model

```{r}
summary(cons_lm1)
summary(cons_lm2)
```

#### SSE

```{r}
deviance(cons_lm1)
deviance(cons_lm2)
```

#### Autokorelasi

```{r}
#durbin watson
dwtest(cons_lm1)
dwtest(cons_lm2)
```

#### Heterogenitas

```{r}
bptest(cons_lm1)
bptest(cons_lm2)

```

#### Kenormalan

```{r}
shapiro.test(residuals(cons_lm1))
shapiro.test(residuals(cons_lm2))
```

## Perbandingan Model

```{r}
akurasi <- matrix(c(mape.koyck, mape.dlm, mape.dlm2, mape.ardl))
row.names(akurasi)<- c("Koyck","DLM 1","DLM 2","Autoregressive")
colnames(akurasi) <- c("MAPE")
akurasi
```

Berdasarkan nilai MAPE, model paling optimum didapat pada Model DLM 1 karena memiliki nilai MAPE yang terkecil.

```{r}
par(mfrow=c(1,1))
plot(test$o3, test$AQI, type="b", col="black", ylim=c(0,70))
points(test$o3, fore.koyck$forecasts,col="red")
lines(test$o3, fore.koyck$forecasts,col="red")
points(test$o3, fore.dlm$forecasts,col="blue")
lines(test$o3, fore.dlm$forecasts,col="blue")
points(test$o3, fore.dlm2$forecasts,col="orange")
lines(test$o3, fore.dlm2$forecasts,col="orange")
points(test$o3, fore.ardl$forecasts,col="green")
lines(test$o3, fore.ardl$forecasts,col="green")
legend("topleft",c("aktual", "koyck","DLM 1","DLM 2", "autoregressive"), lty=1, col=c("black","red","blue","orange","green"), cex=0.8)
```

Berdasarkan plot tersebut, terlihat bahwa plot yang paling mendekati NDA aktualnya adalah Model DLM 1, sehingga dapat disimpulkan model terbaik dalam hal ini adalah model regresi DLM 1
